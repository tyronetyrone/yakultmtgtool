(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{710:function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));var o=s(159);var n=s(247);function i(t){return function(t){if(Array.isArray(t))return Object(o.a)(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Object(n.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},793:function(t,e,s){},880:function(t,e,s){"use strict";s(793)},895:function(t,e,s){},962:function(t,e,s){"use strict";s.r(e);s(71),s(158),s(157),s(49),s(73),s(43),s(93),s(14),s(40),s(50);var o=s(710);function n(t,e){var s;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(s=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var o=0,n=function(){};return{s:n,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,c=!1;return{s:function(){s=t[Symbol.iterator]()},n:function(){var t=s.next();return r=t.done,t},e:function(t){c=!0,a=t},f:function(){try{r||null==s.return||s.return()}finally{if(c)throw a}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,o=new Array(e);s<e;s++)o[s]=t[s];return o}var a={name:"Post",key:function(t){return t.fullPath+parseInt((new Date).getTime()/1e3)},layout:"default",scrollToTop:!0,asyncData:function(t){var e=t.app,s=t.params,o=(t.query,t.error,{post_id:s.id});return e.$apiRepository.post.getPostInfo(o).then((function(t){return{type:t.post.type,postInfo:t,post:t.post,user:t.user,author:t.author,errMsg:""}})).catch((function(t){return{errMsg:(t.response.data.retMsg&&void 0!==t.response.data.retMsg?t.response.data.retMsg:null)||"帖子未找到"}}))},data:function(){return{errMsg:"",type:0,postInfo:{},post:{},user:{},author:{},hot_comments:[],hot_comments_total:0,normal_comments:[],normal_comments_total:0,last_comment_id:0,commentOrder:"hot",commentFaction:0,rewardVisible:!1,rewardFire:0,rewardRankVisible:!1,rewardRankList:[],ad_msg:[],recommend_msg:[],ifStickyTop:!1}},head:function(){var t="",e=this.post.tag_json&&""!==this.post.tag_json?JSON.parse(this.post.tag_json):[];if(e.length>0){var s,o=n(e);try{for(o.s();!(s=o.n()).done;){var i=s.value;t+="".concat(i.tag,",")}}catch(t){o.e(t)}finally{o.f()}}var a=this.post.title?"".concat(this.post.title,"-"):"",r=this.author.username?"".concat(this.author.username,"-"):"";return{title:"".concat(a).concat(r),meta:[{hid:"keywords",name:"keywords",content:t},{hid:"description",name:"description",content:this.post.simple_content||""}]}},computed:{tagIdArr:function(){if(!this.post.tag_json)return[];var t,e=[],s=n(this.$utils.checkIsJSON(this.post.tag_json)?JSON.parse(this.post.tag_json):[]);try{for(s.s();!(t=s.n()).done;){var o=t.value;e.push(o.id)}}catch(t){s.e(t)}finally{s.f()}return e}},mounted:function(){if("web"!==this.$utils.judgeSystem())return window.open("".concat("https://mob.iyingdi.com","/post/").concat(this.post.id),"_self"),!1;this.post.reply_num>0&&this.getPostComment(),this.getSideModule(),this.$store.dispatch("tag/setTempPostTagIds",this.tagIdArr),this.getRewardList(),this._scrollListener=this.$utils.throttle(this.handleScroll,500,1e3),window.addEventListener("scroll",this._scrollListener),window.AnalysysAgent.pageView("".concat(this.post.title,"-").concat(this.author.username),{page_type:"帖子",type:"".concat(this.post.type),post_id:"".concat(this.post.id),tag_ids:this.tagIdArr.map(String),author_id:"".concat(this.author.id)})},beforeDestroy:function(){window.removeEventListener("scroll",this._scrollListener),this.$store.dispatch("tag/setTempPostTagIds",[])},methods:{getSideModule:function(){var t=this;if(this.post.tag_json&&""!==this.post.tag_json){var e=JSON.parse(this.post.tag_json)||[];this.$apiRepository.post.getPostSideModuleList({post_id:this.post.id,tag_id:e[0].id}).then((function(e){t.ad_msg=e.ad_msg||[],t.recommend_msg=e.recommend_msg||[]}))}},getRewardList:function(){var t=this;this.$apiRepository.post.getPostRewardRank({post_id:this.post.id,page:1,size:4}).then((function(e){var s=e.rank||[];t.rewardRankList=s})).catch((function(t){}))},toOperatePost:function(t){var e=this;if(!this.$store.getters.token)return this.$router.push("".concat(this.$settings.routePre,"/login")),!1;switch(t){case"like":var s=this.post.like_num+1;if(1===this.user.action)return this.$message({type:"warning",message:"您已经赞过了",offset:300}),!1;this.$apiRepository.post.postLike({post_id:this.postInfo.post.id,action:1}).then((function(t){e.$set(e.user,"action",1),e.$set(e.post,"like_num",s),e.$message({type:"success",message:"点火成功",offset:300})})).catch((function(t){var s=t.response.data.retMsg&&void 0!==t.response.data.retMsg?t.response.data.retMsg:null;e.$message.error(s||"点火失败")})),window.AnalysysAgent.track("post_detail_like_post_click",{post_id:"".concat(this.postInfo.post.id),author_id:"".concat(this.postInfo.author.id),tag_ids:this.tagIdArr.map(String),type:"".concat(this.postInfo.post.type)});break;case"hate":var o=this.post.like_num;if(2===this.user.action)return this.$message({type:"warning",message:"您已经踩过了",offset:300}),!1;1===this.user.action&&(o-=1),this.$apiRepository.post.postLike({post_id:this.postInfo.post.id,action:2}).then((function(t){e.$set(e.user,"action",2),e.$set(e.post,"like_num",o),e.$message({type:"success",message:"点踩成功",offset:300})})).catch((function(t){var s=t.response.data.retMsg&&void 0!==t.response.data.retMsg?t.response.data.retMsg:null;e.$message.error(s||"点踩失败")})),window.AnalysysAgent.track("post_detail_dislike_post_click",{post_id:"".concat(this.postInfo.post.id),author_id:"".concat(this.postInfo.author.id),tag_ids:this.tagIdArr.map(String),type:"".concat(this.postInfo.post.type)});break;case"collect":this.$apiRepository.post.postCollect({post_ids:this.postInfo.post.id}).then((function(t){e.$set(e.user,"collected",!e.user.collected)})).catch((function(t){var s=t.response.data.retMsg&&void 0!==t.response.data.retMsg?t.response.data.retMsg:null;e.$message.error(s||"操作失败")})),window.AnalysysAgent.track("".concat(this.user.collected?"post_detail_cancle_collect":"post_detail_collect_click"),{post_id:"".concat(this.postInfo.post.id),author_id:"".concat(this.postInfo.author.id),tag_ids:this.tagIdArr.map(String),type:"".concat(this.postInfo.post.type)});break;case"reward":if(0===this.rewardFire)return this.$message.warning("请选择打赏金额"),!1;this.$apiRepository.post.postAward({post_id:this.postInfo.post.id,fire:this.rewardFire}).then((function(t){e.rewardVisible=!1,e.$message.success("打赏成功")})).catch((function(t){var s=t.response.data.retMsg&&void 0!==t.response.data.retMsg?t.response.data.retMsg:null;e.$message.error(s||"打赏失败")}))}},toReward:function(){this.$store.getters.token?this.rewardVisible=!0:this.$router.push("".concat(this.$settings.routePre,"/login"))},getPostComment:function(){var t=this,e={post_id:this.post.id,size:10,last_comment_id:this.last_comment_id,order:this.commentOrder,vote_faction:this.commentFaction};this.$apiRepository.comment.getCommentList(e).then((function(e){if(0!==t.last_comment_id)return t.normal_comments=[].concat(Object(o.a)(t.normal_comments),Object(o.a)(e.normal_comments)),!1;t.hot_comments_total=e.hot_num,t.normal_comments_total=e.normal_num-e.hot_num,t.hot_comments=e.hot_comments,t.normal_comments=Object(o.a)(e.normal_comments)})).catch((function(t){}))},handleScroll:function(){this.sideBarSticky(),this.post.reply_num>0&&this.commentScroll()},sideBarSticky:function(){var t=document.documentElement.scrollTop||document.body.scrollTop,e=document.getElementById("sticky_area").offsetTop;this.ifStickyTop=t>=e},commentScroll:function(){var t=document.documentElement.scrollTop||document.body.scrollTop,e=document.documentElement.clientHeight||document.body.clientHeight;if((document.documentElement.scrollHeight||document.body.scrollHeight)-(t+e)>=400||this.normal_comments.length>=this.normal_comments_total)return!1;this.last_comment_id=this.normal_comments[this.normal_comments.length-1].main_comment.comment.id,this.getPostComment()},commentToOrder:function(){this.last_comment_id=0,this.commentOrder="hot"===this.commentOrder?"created":"hot",this.getPostComment(),window.AnalysysAgent.track("post_detail_change_comment_sort",{sort_type:"hot"===this.commentOrder?"热度":"时间"})},commentVoteFilter:function(t){if(Number(t)===this.commentFaction)return!1;this.last_comment_id=0,this.commentFaction=Number(t),this.getPostComment()},sendPostComment:function(t){var e=this,s={post_id:this.post.id,parent_id:0,anonymous:0,content:t.content,imgs:t.imgs.join("`")};this.$apiRepository.comment.createComment(s).then((function(t){e.$message({type:"success",message:"发表成功",offset:300}),e.normal_comments.unshift({main_comment:t,reply_comments:[]})})).catch((function(t){e.$message.error(t.response.data.retMsg)}))}}},r=(s(880),s(20)),c=Object(r.a)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"post-detail-page"},[""===t.errMsg?s("div",{staticClass:"show"},[s("div",{staticClass:"main-content-area"},[[13,12,21].includes(t.type)?s("PostRichDetail",{attrs:{"post-info":t.postInfo}}):s("PostCommonDetail",{attrs:{"post-info":t.postInfo}}),t._v(" "),s("div",{staticClass:"mt-30 flex flex-row justify-center"},[s("a",{staticClass:"reward-btn",on:{click:t.toReward}},[t._v("打赏文章")]),t._v(" "),s("el-dialog",{attrs:{visible:t.rewardVisible,"lock-scroll":!1,title:"选择打赏金额",width:"600px"},on:{"update:visible":function(e){t.rewardVisible=e}}},[s("div",{staticClass:"mx-auto"},[s("div",{staticClass:"choose-fire-amount grid grid-cols-3 gap-5 text-center"},[s("div",{class:{checked:10===t.rewardFire},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.rewardFire=10}}},[t._v("10营火")]),t._v(" "),s("div",{class:{checked:50===t.rewardFire},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.rewardFire=50}}},[t._v("50营火")]),t._v(" "),s("div",{class:{checked:100===t.rewardFire},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.rewardFire=100}}},[t._v("100营火")]),t._v(" "),s("div",{class:{checked:200===t.rewardFire},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.rewardFire=200}}},[t._v("200营火")]),t._v(" "),s("div",{class:{checked:500===t.rewardFire},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.rewardFire=500}}},[t._v("500营火")]),t._v(" "),s("div",{class:{checked:1e3===t.rewardFire},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.rewardFire=1e3}}},[t._v("1000营火")])])]),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.toOperatePost("reward")}}},[t._v("打赏")])],1)])],1),t._v(" "),t.rewardRankList.length?s("div",{staticClass:"m-30 pb-20 bg-gray-100"},[t._m(0),t._v(" "),t._l(t.rewardRankList.slice(0,3),(function(e,o){return s("div",{key:o,staticClass:"mb-10 px-30"},[s("div",{staticClass:"pb-2 flex flex-row justify-between items-center border-b border-gray-D8 border-dashed"},[s("UserTitle",{attrs:{user:e}}),t._v(" "),s("span",{staticClass:"text-gray-400 text-sm"},[t._v("打赏了"+t._s(e.amount)+"营火")])],1)])})),t._v(" "),t.rewardRankList.length>3?s("div",{staticClass:"text-center"},[s("a",{staticClass:"text-blue-500 cursor-pointer text-sm",on:{click:function(e){t.rewardRankVisible=!0}}},[t._v("查看全部")])]):t._e(),t._v(" "),s("PostRewardRank",{attrs:{visible:t.rewardRankVisible,"post-id":t.post.id},on:{"update:visible":function(e){t.rewardRankVisible=e}}})],2):t._e(),t._v(" "),t.post.rs_feed_created?s("div",{staticClass:"mt-30 px-30"},[s("div",{staticClass:"flex flex-row items-center space-x-1"},[s("img",{staticClass:"w-20",attrs:{src:"https://wspic.iyingdi.com/yingdiWeb/images/bbspost/hasrecommend.png"}}),t._v(" "),s("span",[t._v("本帖被推荐于"+t._s(t._f("formatTime")(t.post.rs_feed_created)))])])]):t._e(),t._v(" "),s("div",{staticClass:"mt-30 px-30 flex flex-row justify-between items-center"},[t.user.action>0?s("div",{staticClass:"flex flex-row items-center"},[s("a",{staticClass:"like-btn cursor-pointer",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.toOperatePost("like")}}},[1===t.user.action?s("span",[t._v("已点火")]):s("span",[t._v("点火")]),t._v(" "),t.post.like_num?s("span",[t._v(t._s(t.post.like_num))]):t._e()]),t._v(" "),s("a",{staticClass:"hate-btn cursor-pointer",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.toOperatePost("hate")}}},[2===t.user.action?s("span",[t._v("已踩")]):s("span",[t._v("踩")])])]):s("div",{staticClass:"flex flex-row items-center"},[s("a",{staticClass:"like-btn cursor-pointer",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.toOperatePost("like")}}},[s("span",[t._v("点火")]),t.post.like_num?s("span",[t._v(t._s(t.post.like_num))]):t._e()]),t._v(" "),s("a",{staticClass:"hate-btn cursor-pointer",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.toOperatePost("hate")}}},[s("span",[t._v("踩")])])]),t._v(" "),s("a",{staticClass:"collect-btn",class:{hasCollected:t.user.collected},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.toOperatePost("collect")}}},[s("i",{staticClass:"el-icon-star-off"}),t._v(" "),s("span",[t._v(t._s(t.user.collected?"已收藏":"收藏"))])])]),t._v(" "),s("div",{staticClass:"write-area"},[s("CommentInput",{on:{send:t.sendPostComment}})],1),t._v(" "),s("PostDetailGoogleAd",{staticClass:"mt-10 px-30"}),t._v(" "),s("div",{staticClass:"comments-area"},[t.hot_comments.length>0?s("div",{staticClass:"mb-30"},[s("div",{staticClass:"mx-40 pb-10 border-b border-gray-EA"},[s("span",{staticClass:"text-black text-base font-bold"},[t._v("热门评论 "+t._s(t.hot_comments_total)+"条")])]),t._v(" "),s("div",{staticClass:"px-30 space-y-10 divide-y divide-gray-EA"},t._l(t.hot_comments,(function(e,o){return s("CommentItem",{key:""+e.main_comment.comment.id+o,attrs:{"comment-info":e,"post-type":t.post.type}})})),1)]):t._e(),t._v(" "),s("div",{staticClass:"comment-title mx-40 pb-10 flex flex-row justify-between items-center border-b border-gray-EA"},[s("div",{staticClass:"faction-text text-lg text-gray-400"},[s("span",{staticClass:"f-text text-black text-base font-bold cursor-pointer",class:t.commentFaction?"":"select",on:{click:function(e){return e.stopPropagation(),t.commentVoteFilter(0)}}},[t._v("全部评论 "+t._s(t.post.reply_num)+"条")]),t._v(" "),[15].includes(t.post.type)?s("div",{staticClass:"inline cursor-pointer"},[s("span",{staticClass:"f-text text-red-500 mx-20",class:1===t.commentFaction?"select":"",on:{click:function(e){return e.stopPropagation(),t.commentVoteFilter(1)}}},[t._v("红方评论")]),t._v(" "),s("span",{staticClass:"f-text text-blue-550",class:2===t.commentFaction?"select":"",on:{click:function(e){return e.stopPropagation(),t.commentVoteFilter(2)}}},[t._v("蓝方评论")])]):t._e()]),t._v(" "),s("span",{staticClass:"text-xs text-blue-500 cursor-pointer",on:{click:t.commentToOrder}},[t._v("\n            "+t._s("hot"===t.commentOrder?"按时间排序":"按热度排序")+"\n            "),s("i",{staticClass:"el-icon-sort"})])]),t._v(" "),t.normal_comments.length>0?s("div",[s("div",{staticClass:"px-30 space-y-10 divide-y divide-gray-EA"},t._l(t.normal_comments,(function(e,o){return s("CommentItem",{key:""+e.main_comment.comment.id+o,attrs:{"comment-info":e,"post-type":t.post.type}})})),1)]):t._e(),t._v(" "),t.normal_comments.length||t.hot_comments.length?t._e():s("div",{staticClass:"m-40 text-center text-gray-800"},[s("img",{staticClass:"w-96 h-96 mx-auto",attrs:{src:t.$settings.content_empty_image,alt:""}}),t._v(" "),s("p",{staticClass:"text-gray-800 mt-10"},[t._v("还没有评论")])])])],1),t._v(" "),s("div",{staticClass:"side-bar-area"},[s("AuthorInfo",{attrs:{"author-id":t.author.id,"if-follow":t.user.follow_author}}),t._v(" "),s("GoogleAd"),t._v(" "),s("div",{attrs:{id:"sticky_area"}},[t.ifStickyTop?s("AuthorInfo",{staticClass:"author-info-sticky",attrs:{"author-id":t.author.id,"if-follow":t.user.follow_author}}):t._e()],1)],1)]):s("div",{staticClass:"mx-auto space-y-20"},[s("img",{staticClass:"mx-auto",staticStyle:{width:"384px"},attrs:{src:t.$settings.content_empty_image,alt:""}}),t._v(" "),s("div",{staticClass:"text-center"},[t._v(t._s(t.errMsg))])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"flex flex-row justify-between px-30 pt-20 pb-10"},[e("span",{staticClass:"text-gray-800 font-bold text-base"},[this._v("打赏榜")])])}],!1,null,"12211d7d",null);e.default=c.exports;installComponents(c,{PostRichDetail:s(917).default,PostCommonDetail:s(923).default,UserTitle:s(733).default,PostRewardRank:s(924).default,CommentInput:s(746).default,PostDetailGoogleAd:s(925).default,CommentItem:s(926).default,AuthorInfo:s(927).default,GoogleAd:s(715).default})}}]);